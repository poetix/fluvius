
<!DOCTYPE html>
<!--
 Generated by Apache Maven Doxia at 2017-06-06
 Rendered using Reflow Maven Skin 1.1.1 (http://andriusvelykis.github.io/reflow-maven-skin)
-->
<html  xml:lang="en" lang="en">

	<head>
		<meta charset="UTF-8" />
		<title>fluvius - Fluvius</title>
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<meta name="description" content="" />
		<meta http-equiv="content-language" content="en" />

		<link href="http://netdna.bootstrapcdn.com/bootswatch/2.3.2/spruce/bootstrap.min.css" rel="stylesheet" />
		<link href="http://netdna.bootstrapcdn.com/twitter-bootstrap/2.3.1/css/bootstrap-responsive.min.css" rel="stylesheet" />
		<link href="./css/bootswatch.css" rel="stylesheet" />
		<link href="./css/reflow-skin.css" rel="stylesheet" />


		<link href="./css/lightbox.css" rel="stylesheet" />

		<link href="./css/site.css" rel="stylesheet" />
		<link href="./css/print.css" rel="stylesheet" media="print" />

		<!-- Le HTML5 shim, for IE6-8 support of HTML5 elements -->
		<!--[if lt IE 9]>
			<script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
		<![endif]-->



	</head>

	<body class="page-index project-fluvius" data-spy="scroll" data-offset="60" data-target="#toc-scroll-target">

		<div class="navbar navbar-fixed-top">
			<div class="navbar-inner">
				<div class="container">
					<a class="btn btn-navbar" data-toggle="collapse" data-target="#top-nav-collapse">
						<span class="icon-bar"></span>
						<span class="icon-bar"></span>
						<span class="icon-bar"></span>
					</a>
					<div class="nav-collapse collapse" id="top-nav-collapse">
						<ul class="nav pull-right">
							<li class="dropdown active">
								<a href="#" class="dropdown-toggle" data-toggle="dropdown">Project Documentation <b class="caret"></b></a>
								<ul class="dropdown-menu">
									<li class="dropdown-submenu ">
										<a href="project-info.html" title="Project Information">Project Information</a>
										<ul class="dropdown-menu">
											<li ><a href="dependencies.html" title="Dependencies">Dependencies</a></li>
											<li ><a href="dependency-convergence.html" title="Dependency Convergence">Dependency Convergence</a></li>
											<li ><a href="dependency-info.html" title="Dependency Information">Dependency Information</a></li>
											<li ><a href="distribution-management.html" title="Distribution Management">Distribution Management</a></li>
											<li class="active"><a href="" title="About">About</a></li>
											<li ><a href="plugin-management.html" title="Plugin Management">Plugin Management</a></li>
											<li ><a href="plugins.html" title="Plugins">Plugins</a></li>
											<li ><a href="team-list.html" title="Team">Team</a></li>
											<li ><a href="source-repository.html" title="Source Code Management">Source Code Management</a></li>
											<li ><a href="project-summary.html" title="Summary">Summary</a></li>
										</ul>
									</li>
									<li class="dropdown-submenu ">
										<a href="project-reports.html" title="Project Reports">Project Reports</a>
										<ul class="dropdown-menu">
											<li ><a href="checkstyle.html" title="Checkstyle">Checkstyle</a></li>
											<li ><a href="apidocs/index.html" title="JavaDocs">JavaDocs</a></li>
											<li ><a href="testapidocs/index.html" title="Test JavaDocs">Test JavaDocs</a></li>
										</ul>
									</li>
								</ul>
							</li>
						</ul>
					</div><!--/.nav-collapse -->
				</div>
			</div>
		</div>

	<div class="container">

	<!-- Masthead
	================================================== -->

	<header>
		<div>
			<ul class="breadcrumb">
				<li class="projectVersion version-date">Version: 1.1-SNAPSHOT</li>
				<li class="divider">|</li>
				<li class="publishDate version-date">Last Published: 2017-06-06</li>
			</ul>
		</div>
	</header>

	<div class="main-body">
	<div class="row">
		<div class="span12">
			<div class="body-content">
<div class="page-header">
 <h1>Fluvius</h1>
</div> 
<p><i>Fluvius</i> provides a simple API for co-ordinating sequences of actions, which may include branching logic (but no more complex control flow than that).</p> 
<p>Here’s an example sequence, for processing a request to update a user’s details.</p> 
<div class="source"> 
 <pre>Sequence:
    1: Check user's credentials
    2: Branch
        2a) If user is authorized: Sequence:
            2a.1: Update user's details
            2a.2: Format success message
        2b) Otherwise: Format failure message
</pre>
</div> 
<p>At the top-level, this sequence might be defined as follows in Java:</p> 
<div class="source"> 
 <pre>Flow&lt;String&gt; updateUserDetails = checkUsersCredentials
    .then(branch(
        ifUserIsAuthorized, updateUserDetails.then(formatSuccessMessage))
        .otherwise(formatFailureMessage));
</pre>
</div> 
<p>In this example, <tt>checkUsersCredentials</tt> is a <tt>Flow</tt> which performs a single action: it accepts a user name and password, and returns an authorisation response:</p> 
<div class="source"> 
 <pre>Flow&lt;AuthorizationResponse&gt; checkUsersCredentials = Flow
    .obtaining(authorizationResponse)
    .from(userName, password)
    .using(&quot;Check user's credentials&quot;, new F2&lt;String, String, AuthorizationResponse&gt;() {
        @Override
        public AuthorizationResponse apply(String userName, String password) {
            // Authorization logic goes here
        }
    });
</pre>
</div> 
<p>We supply a function (in this case, an anonymous inner class extending the <tt>F2</tt> interface) to do the work.</p> 
<p>The <tt>obtaining</tt> and <tt>from</tt> expressions in the above code both accept <tt>Key</tt>s, which index values written onto a scratchpad used by the flow. Here’s how those are defined:</p> 
<div class="source"> 
 <pre>Key&lt;AuthorizationResponse&gt; authorizationResponse = Key.named(&quot;authorizationResponse&quot;);
Key&lt;String&gt; userName = Key.named(&quot;userName&quot;);
Key&lt;String&gt; password = Key.named(&quot;password&quot;);
</pre>
</div> 
<p>A <tt>Key&lt;T&gt;</tt> provides a type-safe way of retrieving a value of type <tt>T</tt> from a <tt>Scratchpad</tt>, and of populating a Scratchpad with values:</p> 
<div class="source"> 
 <pre>Scratchpad scratchpad = Scratchpads.create(
    userName.of(&quot;Arthur&quot;),
    password.of(&quot;Super-secret password&quot;));

String myUserName = scratchpad.get(userName);
</pre>
</div> 
<p>A flow will typically read one or more values from the scratchpad, and write a new value onto the scratchpad at the end. By specifying which keys it requires, and which key it provides, we can reason about the inputs needed for a flow to run.</p> 
<p>For example, suppose we join two flows together:</p> 
<div class="source"> 
 <pre>Flow&lt;String&gt; getAccessToken = Flows
        .obtaining(accessToken)
        .from(userName, password)
        .using(&quot;Authorize user&quot;, new F2&lt;String, String, String&gt;() {
            @Override
            public String apply(String username, String password) {
                return &quot;ACCESS TOKEN&quot;;
            }
        });

Flow&lt;Double&gt; getLocalTemperature = Flows
        .obtaining(temperature)
        .from(accessToken, postcode)
        .using(&quot;Get local temperature&quot;, new F2&lt;String, String, Double&gt;() {
            @Override
            public Double apply(String accessCode, String postcode) {
                return 26D;
            }
        });

Flow&lt;Double&gt; completeFlow = getAccessToken.then(getLocalTemperature);

System.out.println(Flows.prettyPrint(completeFlow));
</pre>
</div> 
<p>Note the use of the <tt>then</tt> method on <tt>Flow</tt> to join two flows together. The pretty-printer will represent the combined flow as follows:</p> 
<div class="source"> 
 <pre>Sequence (requires [userName,password,postcode], provides temperature):
    1: Authorize user (requires [userName,password], provides accessToken)
    2: Get local temperature (requires [accessToken,postcode], provides temperature)
</pre>
</div> 
<p>We can see that in order to run the whole sequence, we need to supply a scratchpad with values populated for <tt>userName</tt>, <tt>password</tt> and <tt>postcode</tt>. The first step in the sequence uses only <tt>userName</tt> and <tt>password</tt>, and writes a value for <tt>accessToken</tt> into the scratchpad. The second step uses this <tt>accessToken</tt>, but also requires the <tt>postcode</tt> value.</p> 
<p>Here’s how we run the flow:</p> 
<div class="source"> 
 <pre>Double result = Flows.run(
        completeFlow,
        Scratchpads.create(
            userName.of(&quot;Arthur&quot;),
            password.of(&quot;Special secret password&quot;),
            postcode.of(&quot;VB6 5UX&quot;)),
        Visitors.logging(Visitors.getDefault())
);
</pre>
</div> 
<p>The flow is assembled into an executable <tt>Action</tt> by a <tt>FlowVisitor</tt>, and this <tt>Action</tt> is run to obtain a result. The default visitor simply assembles the pieces of the flow together, but we can supply visitors that perform other actions such as logging flow steps or dispatching them to be run by a local or remote executor. In this case, we’ve added logging in to the execution behaviour we want, so that we can see how the flow runs. Here’s what that prints out:</p> 
<div class="source"> 
 <pre>INFO: Running action Authorize user with scratchpad {userName=Arthur, password=Special secret password, postcode=VB6 5UX}
INFO: Action Authorize user returned result ACCESS TOKEN
INFO: Running action Get local temperature with scratchpad {accessToken=ACCESS TOKEN, password=Special secret password, postcode=VB6 5UX, userName=Arthur}
INFO: Action Get local temperature returned result 26.0
</pre>
</div>
			</div>
		</div>
	</div>
	</div>

	</div><!-- /container -->

	<!-- Footer
	================================================== -->
	<footer class="well">
		<div class="container">
			<div class="row">
				<div class="span9 bottom-nav">
					<ul class="nav nav-list">
						<li class="nav-header">Project Documentation</li>
						<li >
							<a href="project-info.html" title="Project Information">Project Information <i class="icon-chevron-down"></i></a>
							<ul class="nav nav-list">
						<li >
							<a href="dependencies.html" title="Dependencies">Dependencies</a>
						</li>
						<li >
							<a href="dependency-convergence.html" title="Dependency Convergence">Dependency Convergence</a>
						</li>
						<li >
							<a href="dependency-info.html" title="Dependency Information">Dependency Information</a>
						</li>
						<li >
							<a href="distribution-management.html" title="Distribution Management">Distribution Management</a>
						</li>
						<li class="active">
							<a href="#" title="About">About</a>
						</li>
						<li >
							<a href="plugin-management.html" title="Plugin Management">Plugin Management</a>
						</li>
						<li >
							<a href="plugins.html" title="Plugins">Plugins</a>
						</li>
						<li >
							<a href="team-list.html" title="Team">Team</a>
						</li>
						<li >
							<a href="source-repository.html" title="Source Code Management">Source Code Management</a>
						</li>
						<li >
							<a href="project-summary.html" title="Summary">Summary</a>
						</li>
							</ul>
						</li>
						<li >
							<a href="project-reports.html" title="Project Reports">Project Reports <i class="icon-chevron-right"></i></a>
						</li>
					</ul>
				</div>
			</div>
		</div>
	</footer>

	<div class="container subfooter">
		<div class="row">
			<div class="span12">
				<p class="pull-right"><a href="#">Back to top</a></p>
				<p class="copyright">Copyright &copy;2017. All Rights Reserved.</p>
				<p><a href="http://github.com/andriusvelykis/reflow-maven-skin" title="Reflow Maven skin">Reflow Maven skin</a> by <a href="http://andrius.velykis.lt" target="_blank" title="Andrius Velykis">Andrius Velykis</a>.</p>
			</div>
		</div>
	</div>

	<!-- Le javascript
	================================================== -->
	<!-- Placed at the end of the document so the pages load faster -->
	<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>

	<script src="http://netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/js/bootstrap.min.js"></script>
	<script src="./js/lightbox.min.js"></script>
	<script src="./js/reflow-scroll.js"></script>

	<script src="./js/reflow-skin.js"></script>

	</body>
</html>
