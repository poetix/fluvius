<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia Site Renderer 1.7.1 at 2017-06-20 
 | Rendered using Apache Maven Fluido Skin 1.6
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="Date-Revision-yyyymmdd" content="20170620" />
    <meta http-equiv="Content-Language" content="en" />
    <title>fluvius &#x2013; Fluvius</title>
    <link rel="stylesheet" href="./css/apache-maven-fluido-1.6.min.css" />
    <link rel="stylesheet" href="./css/site.css" />
    <link rel="stylesheet" href="./css/print.css" media="print" />
      <script type="text/javascript" src="./js/apache-maven-fluido-1.6.min.js"></script>
      </head>
    <body class="topBarEnabled">
                      <a href="https://github.com/poetix/fluvius">
      <img style="position: absolute; top: 0; right: 0; border: 0; z-index: 10000;"
        src="https://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png"
        alt="Fork me on GitHub">
    </a>
      <div id="topbar" class="navbar navbar-fixed-top ">
      <div class="navbar-inner">
        <div class="container-fluid">
        <a data-target=".nav-collapse" data-toggle="collapse" class="btn btn-navbar">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </a>
            <ul class="nav">
        <li class="dropdown">
        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Parent Project <b class="caret"></b></a>
        <ul class="dropdown-menu">
            <li><a href="../index.html" title="fluvius">fluvius</a></li>
        </ul>
      </li>
        <li class="dropdown">
        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Project Documentation <b class="caret"></b></a>
        <ul class="dropdown-menu">
            <li class="dropdown-submenu">
<a href="project-info.html" title="Project Information">Project Information</a>
              <ul class="dropdown-menu">
                  <li><a href="dependencies.html" title="Dependencies">Dependencies</a></li>
                  <li><a href="dependency-info.html" title="Dependency Information">Dependency Information</a></li>
                  <li><a href="dependency-management.html" title="Dependency Management">Dependency Management</a></li>
                  <li><a href="distribution-management.html" title="Distribution Management">Distribution Management</a></li>
                  <li><a href="index.html" title="About">About</a></li>
                  <li><a href="plugin-management.html" title="Plugin Management">Plugin Management</a></li>
                  <li><a href="plugins.html" title="Plugins">Plugins</a></li>
                  <li><a href="team-list.html" title="Team">Team</a></li>
                  <li><a href="source-repository.html" title="Source Code Management">Source Code Management</a></li>
                  <li><a href="project-summary.html" title="Summary">Summary</a></li>
              </ul>
            </li>
            <li class="dropdown-submenu">
<a href="project-reports.html" title="Project Reports">Project Reports</a>
              <ul class="dropdown-menu">
                  <li><a href="checkstyle.html" title="Checkstyle">Checkstyle</a></li>
                  <li><a href="apidocs/index.html" title="JavaDocs">JavaDocs</a></li>
              </ul>
            </li>
        </ul>
      </li>
              </ul>
            </div>
        </div>
      </div>
    </div>
    <div class="container-fluid">
      <div id="banner">
        <div class="pull-left"><div id="bannerLeft"><h2>fluvius-test</h2>
</div>
</div>
        <div class="pull-right"></div>
        <div class="clear"><hr/></div>
      </div>

      <div id="breadcrumbs">
        <ul class="breadcrumb">
        <li id="publishDate">Last Published: 2017-06-20<span class="divider">|</span>
</li>
          <li id="projectVersion">Version: 1.5-SNAPSHOT</li>
        </ul>
      </div>
      <div class="row-fluid">
        <div id="leftColumn" class="span2">
          <div class="well sidebar-nav">
<ul class="nav nav-list">
          <li class="nav-header">Parent Project</li>
    <li><a href="../index.html" title="fluvius"><span class="none"></span>fluvius</a>  </li>
          <li class="nav-header">Project Documentation</li>
    <li><a href="project-info.html" title="Project Information"><span class="icon-chevron-down"></span>Project Information</a>
      <ul class="nav nav-list">
    <li><a href="dependencies.html" title="Dependencies"><span class="none"></span>Dependencies</a>  </li>
    <li><a href="dependency-info.html" title="Dependency Information"><span class="none"></span>Dependency Information</a>  </li>
    <li><a href="dependency-management.html" title="Dependency Management"><span class="none"></span>Dependency Management</a>  </li>
    <li><a href="distribution-management.html" title="Distribution Management"><span class="none"></span>Distribution Management</a>  </li>
    <li class="active"><a href="#"><span class="none"></span>About</a>
  </li>
    <li><a href="plugin-management.html" title="Plugin Management"><span class="none"></span>Plugin Management</a>  </li>
    <li><a href="plugins.html" title="Plugins"><span class="none"></span>Plugins</a>  </li>
    <li><a href="team-list.html" title="Team"><span class="none"></span>Team</a>  </li>
    <li><a href="source-repository.html" title="Source Code Management"><span class="none"></span>Source Code Management</a>  </li>
    <li><a href="project-summary.html" title="Summary"><span class="none"></span>Summary</a>  </li>
      </ul>
  </li>
    <li><a href="project-reports.html" title="Project Reports"><span class="icon-chevron-right"></span>Project Reports</a>  </li>
  </ul>
          <hr />
          <div id="poweredBy">
              <div class="clear"></div>
              <div class="clear"></div>
              <div class="clear"></div>
              <div class="clear"></div>
  <a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy"><img class="builtBy" alt="Built by Maven" src="./images/logos/maven-feather.png" /></a>
              </div>
          </div>
        </div>
        <div id="bodyColumn"  class="span10" >
<h1>Fluvius</h1>
<p><a class="externalLink" href="http://search.maven.org/#search%7Cga%7C1%fluvius"><img src="https://img.shields.io/maven-central/v/com.codepoetics/fluvius.svg" alt="Maven Central" /></a> <a class="externalLink" href="https://travis-ci.org/poetix/fluvius"><img src="https://travis-ci.org/poetix/fluvius.svg?branch=master" alt="Build Status" /></a></p>
<p><i>Fluvius</i> provides a simple API for co-ordinating sequences of actions, which may include branching logic (but no more complex control flow than that).</p>
<p>Here&#x2019;s an example sequence, for processing a request to update a user&#x2019;s details.</p>

<div>
<pre>
Sequence:
    1: Check user's credentials
    2: Branch
        2a) If user is authorized: Sequence:
            2a.1: Update user's details
            2a.2: Format success message
        2b) Otherwise: Format failure message
</pre></div>
<p>At the top-level, this sequence might be defined as follows in Java:</p>

<div class="source">
<div class="source"><pre class="prettyprint linenums">Flow&lt;String&gt; updateUserDetails = checkUsersCredentials
    .then(branch(
        ifUserIsAuthorized, updateUserDetails.then(formatSuccessMessage))
        .otherwise(formatFailureMessage));
</pre></div></div>
<p>In this example, <tt>checkUsersCredentials</tt> is a <tt>Flow</tt> which performs a single action: it accepts a user name and password, and returns an authorisation response:</p>

<div class="source">
<div class="source"><pre class="prettyprint linenums">Flow&lt;AuthorizationResponse&gt; checkUsersCredentials = Flow
    .obtaining(authorizationResponse)
    .from(userName, password)
    .using(&quot;Check user's credentials&quot;, new F2&lt;String, String, AuthorizationResponse&gt;() {
        @Override
        public AuthorizationResponse apply(String userName, String password) {
            // Authorization logic goes here
        }
    });
</pre></div></div>
<p>We supply a function (in this case, an anonymous inner class extending the <tt>F2</tt> interface) to do the work.</p>
<p>The <tt>obtaining</tt> and <tt>from</tt> expressions in the above code both accept <tt>Key</tt>s, which index values written onto a scratchpad used by the flow. Here&#x2019;s how those are defined:</p>

<div class="source">
<div class="source"><pre class="prettyprint linenums">Key&lt;AuthorizationResponse&gt; authorizationResponse = Key.named(&quot;authorizationResponse&quot;);
Key&lt;String&gt; userName = Key.named(&quot;userName&quot;);
Key&lt;String&gt; password = Key.named(&quot;password&quot;);
</pre></div></div>
<p>A <tt>Key&lt;T&gt;</tt> provides a type-safe way of retrieving a value of type <tt>T</tt> from a <tt>Scratchpad</tt>, and of populating a Scratchpad with values:</p>

<div class="source">
<div class="source"><pre class="prettyprint linenums">Scratchpad scratchpad = Scratchpads.create(
    userName.of(&quot;Arthur&quot;),
    password.of(&quot;Super-secret password&quot;));

String myUserName = scratchpad.get(userName);
</pre></div></div>
<p>A flow will typically read one or more values from the scratchpad, and write a new value onto the scratchpad at the end. By specifying which keys it requires, and which key it provides, we can reason about the inputs needed for a flow to run.</p>
<p>For example, suppose we join two flows together:</p>

<div class="source">
<div class="source"><pre class="prettyprint linenums">Flow&lt;String&gt; getAccessToken = Flows
        .obtaining(accessToken)
        .from(userName, password)
        .using(&quot;Authorize user&quot;, new F2&lt;String, String, String&gt;() {
            @Override
            public String apply(String username, String password) {
                return &quot;ACCESS TOKEN&quot;;
            }
        });

Flow&lt;Double&gt; getLocalTemperature = Flows
        .obtaining(temperature)
        .from(accessToken, postcode)
        .using(&quot;Get local temperature&quot;, new F2&lt;String, String, Double&gt;() {
            @Override
            public Double apply(String accessCode, String postcode) {
                return 26D;
            }
        });

Flow&lt;Double&gt; completeFlow = getAccessToken.then(getLocalTemperature);

System.out.println(Flows.prettyPrint(completeFlow));
</pre></div></div>
<p>Note the use of the <tt>then</tt> method on <tt>Flow</tt> to join two flows together. The pretty-printer will represent the combined flow as follows:</p>

<div>
<pre>
Sequence (requires [userName,password,postcode], provides temperature):
    1: Authorize user (requires [userName,password], provides accessToken)
    2: Get local temperature (requires [accessToken,postcode], provides temperature)
</pre></div>
<p>We can see that in order to run the whole sequence, we need to supply a scratchpad with values populated for <tt>userName</tt>, <tt>password</tt> and <tt>postcode</tt>. The first step in the sequence uses only <tt>userName</tt> and <tt>password</tt>, and writes a value for <tt>accessToken</tt> into the scratchpad. The second step uses this <tt>accessToken</tt>, but also requires the <tt>postcode</tt> value.</p>
<p>Here&#x2019;s how we run the flow:</p>

<div class="source">
<div class="source"><pre class="prettyprint linenums">Double result = Flows.run(
        completeFlow,
        Scratchpads.create(
            userName.of(&quot;Arthur&quot;),
            password.of(&quot;Special secret password&quot;),
            postcode.of(&quot;VB6 5UX&quot;)),
        Visitors.logging(Visitors.getDefault())
);
</pre></div></div>
<p>The flow is assembled into an executable <tt>Action</tt> by a <tt>FlowVisitor</tt>, and this <tt>Action</tt> is run to obtain a result. The default visitor simply assembles the pieces of the flow together, but we can supply visitors that perform other actions such as logging flow steps or dispatching them to be run by a local or remote executor. In this case, we&#x2019;ve added logging in to the execution behaviour we want, so that we can see how the flow runs. Here&#x2019;s what that prints out:</p>

<div>
<pre>
2017-06-06T15:21:29.962 Operation 'Authorize user' started with scratchpad {userName=Arthur, password=Special secret password, postcode=VB6 5UX}
2017-06-06T15:21:29.970 Operation 'Authorize user' completed, writing value ACCESS TOKEN to key accessToken
2017-06-06T15:21:29.971 Operation 'Get local temperature' started with scratchpad {userName=Arthur, password=Special secret password, postcode=VB6 5UX, accessToken=ACCESS TOKEN}
2017-06-06T15:21:29.971 Operation 'Get local temperature' completed, writing value 26.0 to key temperature
</pre></div>
        </div>
      </div>
    </div>
    <hr/>
    <footer>
      <div class="container-fluid">
        <div class="row-fluid">
            <p>Copyright &copy;2017.
All rights reserved.</p>
        </div>
        </div>
    </footer>
    </body>
</html>
